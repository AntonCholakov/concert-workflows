# "Vulnerability" > "Scan" Workflows

List of workflows and their usages.

## Fetch Scan files from AWS Inspector as ConcertDef for 1.0.5 
[Fetch_Scan_files_from_AWS_Inspector_as_ConcertDef.zip](./Fetch_Scan_files_from_AWS_Inspector_as_ConcertDef.zip)

##### Prerequisites/Environment: 

- This workflow supports generating AWS Inspector Scan reports for EC2 instances and converting them into the ConcertDef format for ingestion into the workflow. It requires an IAM account with an access key and secret that has sufficient privileges as per AWS Inspector v2 documentation. 
- An Internet connectivity is required. 

##### Support for Amazon Linux Operating System (AL OS): 
- Although version 1.0.5.x primarily supports Red Hat and Windows patching and remediation, Amazon Linux OS can also be supported by deploying SBOMs with the runtime OS name set as `redhat`
- Additionally, this workflow identifies the ALAS number and includes it in the ConcertDef, following the Red Hat remediation approach to ensure machines remain up to date. 
- Currently this workflow utilizes JSON reports from AWS Inspector V2. 

##### Workflow Usage: 

1. Import the workflow into IBM RNA. 
2. Create an authentication entry for "AMAZON WEB SERVICES" using the AWS IAM user’s access key and secret. 
3. Configure Inputs in Main Block: 
    - Set "`awsAuth`" to `<authKey>` (from the authentication listing page). 
    - Set "`BUCKET_NAME`" to the target S3 bucket name. 
    - Set "`BUCKET_ARN`" to the AWS KMS Key ARN for bucket encryption. 

4. Modify AWS Region (if needed): 
    - Default: `us-east-1` 
    - Default region is “us-east-1”; if you want to opt out any of them, update those `region` in below blocks by clicking on the block and update value in `OBJECT EDITOR` on right panel: 
        - `TriggerFindingReportScan` 
        - `Get_Finding_Report_Status` 
        - `GetReportFromS3` 
5. Ensure the selected authentication key is configured in the `IngestToIBM` block as "`authKey`" input. 
6. Enable the `FaaS Block` before execution. [Official Doc](https://www.ibm.com/docs/en/rapid-infra-auto/1.1.x?topic=blocks-faas) | [IBM Internal Doc](https://github.ibm.com/roja/concert-workflows/wiki/Concert-%E2%80%90-Pliant-Installation-Steps.md)
7. Run the workflow. 

##### Further References: 
- To apply filter criteria while creating a findings report, refer to the AWS CLI documentation: [Create Findings Report - AWS CLI](https://awscli.amazonaws.com/v2/documentation/api/latest/reference/inspector2/create-findings-report.html) 
- In case if you face `“ExplodeJson`” cannot start even after 30000 milliseconds, Probably your `FaaS Configuration` needs to recheck. [Official Doc](https://www.ibm.com/docs/en/rapid-infra-auto/1.1.x?topic=blocks-faas) | [IBM Internal Doc](https://github.ibm.com/roja/concert-workflows/wiki/Concert-%E2%80%90-Pliant-Installation-Steps.md)


--- 

##  Sync AWS Linux Bulletin (1.1.0) 
[Sync_AWS_Linux_Bulletin.zip](./Sync_AWS_Linux_Bulletin.zip)

Scrape Amazon Linux Security Advisory (ALAS) data and ingest it into the knowledge base. This process helps identify the correct remediation advisory number for each Amazon Linux OS product against CVEs. 

Sources: 
- [ALAS 2023](https://alas.aws.amazon.com/alas2023.html) 
- [ALAS 2](https://alas.aws.amazon.com/alas2.html)
- [ALAS Index](https://alas.aws.amazon.com/index.html)

For new AWS Inspector2 releases, update the Python block to cache additional HTML pages. 
 

##### Prerequisites/Environment: 
- Workflow, supports generating the AWS Inspector Scan reports for EC2 Instances. And generate a Concert Def format file to get ingested into workflow. This expects you already have an IAM account access key and secret with enough privileges described as per [AWS Inspector v2 Docs](https://docs.aws.amazon.com/inspector/latest/user/managing-multiple-accounts.html).  
- An Internet connectivity is required. 

##### Workflow Usage: 

1. Import the workflow into IBM RNA. 
2. Create an Authentication for Amazon Web Services using the IAM user’s access key and secret. 
3. Configure Inputs in Main Block: 
    - "last_sync_timestamp" → 
        - "" (empty) → Scrape all ALAS data from the beginning (one-time run). 
        - "YYYY-MM-DD HH:mm" → Fetch updates from the last run.  
    - "authorization_payload" → "<BEARER HEADER>  <BEARER_TOKEN>" (Used in the Authorization header).   eg:  “C_API_KEY aWJtY29uY2VydDo3MzQ0YzQ0My==”  
    - "host" → Concert API hostname (e.g., "concert.yourorganization.com"). 
    - "port" → 12443 (Concert user endpoint). 
    - "path" → "/ingestion/api/v1/advisory/create". 
    - "instance_id" → 
        - "0000-0000-0000-0000" (On-prem). 
        - SaaS users should get it from the Concert team. 
4. Set "batch_size" in ETLBlock under parameters (Default: 300, recommended) 

---

##  Tomcat Advisory (2.1.0) 
[Tomcat Advisory](Tomcat_Advisory.zip)

Scrape Tomcat Advisory data and ingest it into the knowledge base. This process helps identify the correct remediation advisory number for each Tomcat version against CVEs. 

Sources: 
- [Tomcat 9](https://tomcat.apache.org/security-9.html) 
- [Tomcat 10](https://tomcat.apache.org/security-10.html)
- [Tomcat 11](https://tomcat.apache.org/security-11.html)

##### Prerequisites/Environment: 
- Workflow, supports generating the advisory details for Tomcat webserver and get ingested into workflow. 
- An Internet connectivity is required. 

##### Workflow Usage: 

1. Import the workflow. 
2. Create an Authentication of type **Config Data** for Concert Config.
    - concert_config: Authentication of type Config Data containing concert config details in the following format.
        ```
        {
        "host": "<concert-host>",
        "port": "<concert-port>",
        "instance_id": "0000-0000-0000-0000",
        "content-type": "application/json",
        "accept": "application/json",
        "username": "<concert_user>",
        "password": "<concert_password>"
        }
        ```
        <img width="551" alt="image" src="https://github.ibm.com/roja/concert-workflows/assets/489467/1e0b9256-c16b-46e6-b63f-df6874c6907b">

3. Create an Authentication for Concert CAPI Key of type **API Key**. 

   <img width="551" alt="image" src="https://github.ibm.com/roja/concert-workflows/assets/489467/8b46fbf8-ecb4-44fb-8ad5-9c9eb7f73dfe">

This workflow takes the following inputs:
* concert_config: Pass the auth we created for Concert Config of type **Config Data** in step 2.
* ConcertApiKey: It is the authentication we created in step 3 for Concert C_API_KEY of type **API_Key**.

<img width="620" alt="image" src="https://github.ibm.com/roja/concert-workflows/assets/489467/a97e93e3-0ee1-4b8b-bb63-9e5889824ea0">

We can run the workflow of schedule the workflow to run as Jobs in specific intervals .

---

##  Tomcat Action Details update (2.1.0) 
[Tomcat Action Details update]()

This workflow is to update the current_version and recommended_version for tomcat where it is missing from the scan report. This workflow will fetch the actions and filter with recommended_version is null or empty. then it will login to the machine and get the current tomcat version and new version to fix the CVEs.


##### Prerequisites/Environment: 
- Workflow, supports fetching tomcat details and update the actions details. 
- An Internet connectivity is required. 

##### Workflow Usage: 

1. Import the workflow. 
2. Create an Authentication of type **Config Data** for Concert Config.
    - concert_config: Authentication of type Config Data containing concert config details in the following format.
        ```
        {
        "host": "<concert-host>",
        "port": "<concert-port>",
        "instance_id": "0000-0000-0000-0000",
        "content-type": "application/json",
        "accept": "application/json",
        "username": "<concert_user>",
        "password": "<concert_password>"
        }
        ```
        <img width="551" alt="image" src="https://github.ibm.com/roja/concert-workflows/assets/489467/1e0b9256-c16b-46e6-b63f-df6874c6907b">

3. Create an Authentication for Concert CAPI Key of type **API Key**. 

    <img width="551" alt="image" src="https://github.ibm.com/roja/concert-workflows/assets/489467/8b46fbf8-ecb4-44fb-8ad5-9c9eb7f73dfe">

4. Create an Authentication for Concert Self hub of type **IBM Hub - Self**. 

    <img width="551" alt="image" src="https://github.ibm.com/roja/concert-workflows/assets/489467/ae4d1b68-40c0-4a6f-bcfe-fe50843d6f9d">

5. Create an Authentication of type **Ansible**
    
    <img width="551" alt="image" src="https://github.ibm.com/roja/concert-workflows/assets/489467/d28c8ada-7cac-4dfe-8ba2-697f4d09a353">

    **Ansible Auth details-** eg-Multiple hosts under same auth
  
     <img width="557" alt="image" src="https://github.ibm.com/roja/concert-workflows/assets/470273/c32706a1-77a6-43f4-b9d0-be2ee2d2d05c">


         Private Key:

           {"redhat-patch.b64":"base64 encode value of the private-key(id_rsa)",
            "linux-test.b64":"base64 encode value of the private-key(id_rsa)"}

         Use the below command to generate Base64 encode value of id_rsa -
         base64 -w 0 ~/.ssh/id_rsa
  
         Inventory:

            [canary]
            9.46.239.156 ansible_host=redhat-linux-patch1.fyre.ibm.com ansible_user=root ansible_ssh_private_key_file=redhat-patch.b64
            9.30.123.9 ansible_host=linux-patch-test1.fyre.ibm.com ansible_user=root ansible_ssh_private_key_file=linux-test.b64

        Below Structure should follow under Inventory to define the canary machines
    
          **<ip_adress> ansible_host=<machine host name> ansible_user=<user> ansible_ssh_private_key_file=<respective filename provided in the Private key>**

        _Note:_ ansible_ssh_private_key_file value in the inventory should match with the key name in the Private Key JSON.

6. Create an Authentication for **Config data** for the VMs with above ansible auths. 
    ```
    {
    "<ip_of_vm_1>": "<ansibel_auth_for_vm1>",
    "<ip_of_vm_2>": "<ansibel_auth_for_vm2>",
    "<ip_of_vm_3>": "<ansibel_auth_for_vm3>",
    }
    ```

# The workflow takes the following inputs:
* concert_config: Pass the auth we created for Concert Config of type **Config Data** in step 2.
* ConcertApiKey: It is the authentication we created in step 3 for Concert C_API_KEY of type **API_Key**.
* ansible_auths: Authentication created in step 6 of type **Config data** for the VMs.
* concert_selfhub: Authentication created of type **IBM Hub - Self** in step 4

    <img width="557" alt="image" src="https://github.ibm.com/roja/concert-workflows/assets/489467/df3b9802-909f-4181-81e3-16f9e2b122f1">

We can run the workflow directly or schedule the workflow to run as Jobs in specific intervals .

---


# Further References: 
- In case if you face “ExplodeJson” cannot start even after 30000 milliseconds, Probably your FaaS Configuration needs to recheck [Official Doc](https://www.ibm.com/docs/en/rapid-infra-auto/1.1.x?topic=blocks-faas) | [IBM Internal Doc](https://github.ibm.com/roja/concert-workflows/wiki/Concert-%E2%80%90-Pliant-Installation-Steps.md).  

---
##  Python Script to Sync AWS Linux Bulletin (1.1.0) 
[scrape_aws_bulletin.py](./scrape_aws_bulletin.py)

 This python script follow the exact step of Sync AWS Linux Bulletin workflow which Scrape Amazon Linux Security Advisory (ALAS) data and ingest it into the knowledge base. This process helps identify the correct remediation advisory number for each Amazon Linux OS product against CVEs.

##### Run command for Scrape AWS Bulletin Script:
```python scrape_aws_bulletin.py --skip-ssl-verify --batch-size custom_batch_size --host your_host_name --api-key your_c_api_key```

Example:

```python scrape_aws_bulletin.py --skip-ssl-verify --batch-size 100 --host sample.fyre.ibm.com --api-key eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9```

---

## Fetch Scan files from AWS Inspector (1.1.0) 
[Fetch_Scan_files_from_AWS_Inspector.zip](./Fetch_Scan_files_from_AWS_Inspector.zip)

Generating AWS Inspector Scan, and Ingest it to IBM Concert as Inspector Report Directly, after minute preprocessing.  this accompanies with the changes of concert 1.1.0 - Build 167  

(1.1.0 and above) 

##### Prerequisites/Environment: 
- Workflow, supports generating the AWS Inspector Scan reports for EC2 Instances. And generate a Concert Def format file to get ingested into workflow. This expects you already have an IAM account access key and secret with enough privileges described as per AWS Inspector v2 Docs.   
- Next Prerequisite is the population of Knowledge Base via workflow `Sync AWS Linux Bulletin` 

- Internet connectivity 

##### Support for Amazon Linux Operating System (AL OS): 
Concert Facilitates Remediation for “amazonlinux” Operating Systems whose SBOMs contain runtime metadata with OS as “amazonlinux”.  

##### Workflow Usage: 

1. Import the workflow into IBM RNA. 
2. Create an Authentication for Amazon Web Services using the IAM user’s access key and secret. 
3. Configure Inputs in Main Block:  
    - `REPORT_FORMAT`  → `JSON` | `CSV`
        - format in which AWS needs to be generate report; recommended "JSON".  
    - `BUCKET_NAME` → 
        - S3 Bucket with KMS encryption into which Inspector want to store file. 

    - “BUCKET_ARN” →  
        - AWS ARN of KMS Key. 
    - “awsAuth” → 
        - as the < authKey > of above Credential. (This can be found from listing page of Authentications)

4. Default region is “us-east-1”; if you want to opt out any of them, update those `region` in below blocks by clicking on the block and update value in “OBJECT EDITOR” on right panel: 
    - “TriggerFindingReportScan” 
    - ” Get_Finding_Report_status” 
    - “GetReportFromS3” 
5. Make sure you are default / opted authKey to connect with concert in the “IngestToIBM” Block. 
6. Make sure your FaaS Block is enabled. While running, if you come across. [Official Doc](https://www.ibm.com/docs/en/rapid-infra-auto/1.1.x?topic=blocks-faas) | [IBM Internal Doc](https://github.ibm.com/roja/concert-workflows/wiki/Concert-%E2%80%90-Pliant-Installation-Steps.md)
7. Run the workflow. 

##### Further References: 
- To apply filter criteria while creating a findings report, refer to the AWS CLI documentation: Create Findings Report - AWS CLI. 
- In case if you face “ExplodeJson” cannot start even after 30000 milliseconds, Probably your FaaS Configuration needs to recheck. [Official Doc](https://www.ibm.com/docs/en/rapid-infra-auto/1.1.x?topic=blocks-faas) | [IBM Internal Doc](https://github.ibm.com/roja/concert-workflows/wiki/Concert-%E2%80%90-Pliant-Installation-Steps.md)

